<div class="admin-rooms">
  <div class="page-header">
    <h1>Rooms Management</h1>
    <button class="btn-primary" (click)="openModal()">Add New Room</button>
  </div>

  <div class="search-bar">
    <input 
      type="text" 
      placeholder="Search rooms..." 
      [(ngModel)]="searchTerm" 
      (input)="filterRooms()"
      class="search-input">
  </div>

  <div class="rooms-grid" *ngIf="!loading">
    <div class="room-card" *ngFor="let room of filteredRooms">
      <div class="room-header">
        <h3>{{ room.roomNumber }}</h3>
        <span class="room-type">{{ room.type }}</span>
      </div>
      
      <div class="room-info">
        <h4>{{ room.title }}</h4>
        <p class="description">{{ room.description }}</p>
        
        <div class="room-details">
          <div class="detail">
            <span class="label">Price:</span>
            <span class="value">${{ room.price }}/night</span>
          </div>
          <div class="detail">
            <span class="label">Capacity:</span>
            <span class="value">{{ room.capacityAdults }} adults, {{ room.capacityChildren }} children</span>
          </div>
          <div class="detail">
            <span class="label">Size:</span>
            <span class="value">{{ room.size }}m²</span>
          </div>
          <div class="detail">
            <span class="label">Floor:</span>
            <span class="value">{{ room.floor }}</span>
          </div>
        </div>

        <div class="room-status">
          <span class="status" [ngClass]="{'available': room.isAvailable, 'unavailable': !room.isAvailable}">
            {{ room.isAvailable ? 'Available' : 'Unavailable' }}
          </span>
        </div>

        <div class="amenities">
          <span class="amenity" *ngFor="let amenity of room.amenities">{{ amenity }}</span>
        </div>
      </div>

      <div class="room-actions">
        <button class="btn-edit" (click)="openModal(room)">Edit</button>
        <button class="btn-delete" (click)="deleteRoom(room)">Delete</button>
      </div>
    </div>
  </div>

  <div class="loading" *ngIf="loading">
    <p>Loading rooms...</p>
  </div>

  <!-- Modal -->
  <div class="modal-overlay" *ngIf="showModal" (click)="closeModal()">
    <div class="modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>{{ editMode ? 'Edit Room' : 'Add New Room' }}</h2>
        <button class="close-btn" (click)="closeModal()">&times;</button>
      </div>

      <form class="modal-form" (ngSubmit)="saveRoom()">
        <div class="form-row">
          <div class="form-group">
            <label>Room Number</label>
            <input type="text" [(ngModel)]="currentRoom.roomNumber" name="roomNumber" required>
          </div>
          <div class="form-group">
            <label>Type</label>
            <select [(ngModel)]="currentRoom.type" name="type" required>
              <option *ngFor="let type of roomTypes" [value]="type">{{ type }}</option>
            </select>
          </div>
        </div>

        <div class="form-group">
          <label>Title</label>
          <input type="text" [(ngModel)]="currentRoom.title" name="title" required>
        </div>

        <div class="form-group">
          <label>Description</label>
          <textarea [(ngModel)]="currentRoom.description" name="description" rows="3" required></textarea>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Price per Night</label>
            <input type="number" [(ngModel)]="currentRoom.price" name="price" min="0" required>
          </div>
          <div class="form-group">
            <label>Size (m²)</label>
            <input type="number" [(ngModel)]="currentRoom.size" name="size" min="1" required>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Adults Capacity</label>
            <input type="number" [(ngModel)]="currentRoom.capacityAdults" name="capacityAdults" min="1" max="10" required>
          </div>
          <div class="form-group">
            <label>Children Capacity</label>
            <input type="number" [(ngModel)]="currentRoom.capacityChildren" name="capacityChildren" min="0" max="5">
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Bed Type</label>
            <select [(ngModel)]="currentRoom.bedType" name="bedType" required>
              <option *ngFor="let bed of bedTypes" [value]="bed">{{ bed }}</option>
            </select>
          </div>
          <div class="form-group">
            <label>Floor</label>
            <input type="number" [(ngModel)]="currentRoom.floor" name="floor" min="1" required>
          </div>
        </div>

        <div class="form-group">
          <label>Amenities</label>
          <div class="amenities-grid">
            <label class="amenity-checkbox" *ngFor="let amenity of availableAmenities">
              <input 
                type="checkbox" 
                [checked]="isAmenitySelected(amenity)"
                (change)="toggleAmenity(amenity)">
              <span>{{ amenity }}</span>
            </label>
          </div>
        </div>

        <div class="form-group">
          <label>Room Photos</label>
          <input type="file" multiple accept="image/*" (change)="onFilesSelected($event)">
          <div class="preview-grid" *ngIf="selectedFiles.length || (currentRoom.images && currentRoom.images.length)">
            <div class="preview" *ngFor="let img of (currentRoom.images || [])">
              <img [src]="img" alt="room image" style="width: 80px; height: 80px; object-fit: cover; border-radius: 6px;">
            </div>
            <div class="preview" *ngFor="let f of selectedFiles">
              <span>{{ f.name }}</span>
            </div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label class="checkbox-label">
              <input type="checkbox" [(ngModel)]="currentRoom.isAvailable" name="isAvailable">
              <span>Available</span>
            </label>
          </div>
          <div class="form-group">
            <label class="checkbox-label">
              <input type="checkbox" [(ngModel)]="currentRoom.smokingAllowed" name="smokingAllowed">
              <span>Smoking Allowed</span>
            </label>
          </div>
          <div class="form-group">
            <label class="checkbox-label">
              <input type="checkbox" [(ngModel)]="currentRoom.petFriendly" name="petFriendly">
              <span>Pet Friendly</span>
            </label>
          </div>
        </div>

        <div class="modal-actions">
          <button type="button" class="btn-cancel" (click)="closeModal()">Cancel</button>
          <button type="submit" class="btn-save">{{ editMode ? 'Update' : 'Create' }} Room</button>
        </div>
      </form>
    </div>
  </div>
</div>
